<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Kodenames Pix</title>
  <meta name="description" content="The HTML5 Herald">
  <meta name="author" content="SitePoint">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <style>
    img {
      display: block;
      border: solid;
      border-width: 1px;
      border-color: black;
    }
    .spymaster {
      display: block;
      border: solid;
      border-width: 5px;
      border-color: white;
    }
    body{
      margin: 0px;
      background: grey;
    }
    #theTable{
      border: solid;
      border-color: red;
    }
    .tint {
      position: relative;
      float: left;
      cursor: pointer;
      -webkit-shadow: rgba(0,0,0,.2) 3px 5px 5px;
      -moz-shadow: rgba(0,0,0,.2) 3px 5px 5px;
      box-shadow: rgba(0,0,0,.2) 3px 5px 5px;
    }
    
    .tint:before {
      content: "";
      display: block;
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      -moz-transition: all .3s linear;
      -webkit-transition: all .3s linear;
      -ms-transition: all .3s linear;
      -o-transition: all .3s linear;
      transition: all .3s linear;
    }
    .tint:before {
      background: rgba(0,255,255, 0.5);
    }
    .red:before{
      background: rgba(255,0,0, 0.5);
    }
    .blue:before {
      background: rgba(0,0,255, 0.5);
    }
    .yellow:before {
       background: rgba(255,255,0, 0.5);
     }
     .green:before {
       background: rgba(0,255,0, 0.5);
     }
     .t5:before {
       background: rgba(0,0,0, 0.5);;
     }
    figure {
      margin: 0 0 0 0;
    }
    .actionBar {
      background-color: #fff;
      color: #000;
      /* text-align: right; */
    }
    .actionBarContainer {
      float: right;
      padding: 8px;
    }
    .logoContainer {
      float: left;
      padding: 0 0 0 16px;
    }
    .logoImg {
      height: 50px;
      border: none;
      float: left;
      cursor: pointer;
    }
    button {
      padding: 8px;
    }
    input {
      margin-right: 16px;
      padding: 6px;
      font-size: 16px;
    }
    .title {
      font-weight: bold;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 20px;
      margin: 14px 0 0 16px;
      float: left;
    }
  </style>
  <script src="seedrandom.js"></script>
  <script>
    var spymaster = false;
    var code = "";
    var defaultLogo = true;

  </script>
  
  <script>
    function renderBoard() {
      if (code.length) {;
        Math.seedrandom(code);
      }
      render(spymaster);
    }
    function onLoad() {
      renderBoard();
      $('#codeId').focus();
    }

    function onInputChange(value) {
      code = value;
      spymaster = spymaster && code.length;
      renderBoard();
    }
    
    function onSpyMasterClick() {
      spymaster = !spymaster && code.length;
      renderBoard();
    }
    function onLogoClick(img) {
      defaultLogo = !defaultLogo;
      img.src = defaultLogo ? "img/blackhat.png" : "img/fedora.png";    
    }
    function render(isSpymaster) {
      $('#theTable').html("");
      if (!code.length) {
        return;
      };
      var arr = [];
      while(arr.length < 25){
             var randomnumber= Math.floor((Math.random() * 278));
             var found=false;
             for(var i=0;i<arr.length;i++){
            if(arr[i]===randomnumber){found=true;break;}
             }
             if(!found) arr.push(randomnumber);
      }

      var imgWidth = $(window).width() / 5.5;
      var imgHeight = imgWidth * 5 / 8;
      var boardHeight = $(window).height() - 51; // Less header height
      if(imgHeight * 5 > boardHeight){
        imgHeight = boardHeight / 5.5;
        imgWidth = imgHeight * 8 / 5;        
      }
      var arrCounter = 0;
      for(var i = 0;i < 5; i++){
        
        $('#theTable').append('<tr id="row' + i + '""></tr>');
        for (var j = 0;j < 5; j++){
          $('#row' + i).append('<td><img class="tile" src="assets/pix' + arr[arrCounter++] + '.png" style="width: ' + imgWidth + 'px; height: ' + imgHeight +'px;"></td>');
        }
      }
      var teams = [];
      //9 8 1 7     
      for(var i = 0;i<7;i++){
        teams.push('redSecret');
        teams.push('blueSecret');
        teams.push('yellowSecret');
      }
      teams.push('redSecret');
      teams.push('blueSecret');
      teams.push('blackSecret');
      //random starter team
      if(Math.floor((Math.random() * 2) + 1) % 2 === 0){
          teams.push('redSecret');
          //make border red
      } else {
        teams.push('blueSecret');
        $('#theTable').css('border-color', 'blue');
      }


      shuffle(teams);
      $( "img.tile" ).each(function() {
        $(this).addClass(teams.pop());
      });


      if(isSpymaster){
        $('img.tile').addClass('spymaster');
        $('img.tile').each(function(){
          if($(this).hasClass('redSecret')){
            $(this).css('border-color', 'red');
          } else if($(this).hasClass('blueSecret')){
            $(this).css('border-color', 'blue');
          } else if($(this).hasClass('yellowSecret')){
            $(this).css('border-color', 'yellow');
          } else if($(this).hasClass('blackSecret')){
            $(this).css('border-color', 'black');
          }  
        });

        $('img.tile').bind('click', function(){
          $(this).wrap('<figure class="tint green"></figure>');
        });
      } else {
        $('img.tile').bind('click', function(){
          if($(this).hasClass('redSecret')){
            $(this).wrap('<figure class="tint red"></figure>');
          } else if($(this).hasClass('blueSecret')){
            $(this).wrap('<figure class="tint blue"></figure>');
          } else if($(this).hasClass('yellowSecret')){
            $(this).wrap('<figure class="tint yellow"></figure>');
          } else if($(this).hasClass('blackSecret')){
            $(this).wrap('<figure class="tint t5"></figure>');
          }  
        }); 
      }
    };

    function shuffle(array) {
      var currentIndex = array.length, temporaryValue, randomIndex;

      // While there remain elements to shuffle...
      while (0 !== currentIndex) {

        // Pick a remaining element...
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;

        // And swap it with the current element.
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
      }

      return array;
    }
  </script>
</head>

<body onload="onLoad()" onresize="renderBoard()">
  <div class="actionBar">
    <div class="actionBarContainer">
      <input id="codeId" type="text" placeholder="Enter code" maxlength="6" onkeyup="onInputChange(this.value)" />
      <button id="spyMasterId" onclick="onSpyMasterClick()">Spy Master</button>
    </div>
    <div class="logoContainer">
      <img class="logoImg"  onclick="onLogoClick(this)" src="img/blackhat.png" />
      <span id="promptId" class="title">Welcome to KodeNames!</span>
    </div>
    <div style="clear: both;"></div>
  </div>
  <table id='theTable' style="width:100%">
  </table>
</body>
</html>
